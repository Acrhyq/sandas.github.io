<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢˜åº“ç³»ç»Ÿ</title>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 15px 0;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        h1, h2, h3 {
            margin-bottom: 15px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: #2196F3;
        }

        .btn-secondary:hover {
            background-color: #0b7dda;
        }

        .btn-danger {
            background-color: #f44336;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* é¢˜ç›®åˆ—è¡¨æ ·å¼ */
        .questions-container {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .question-block {
            padding: 15px;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .question-block:last-child {
            border-bottom: none;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .question-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-unanswered {
            background-color: #e2e6ea;
            color: #383d41;
            border: 1px solid #d3d9df;
        }

        .question-type {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 12px;
            background-color: #e3f2fd;
            color: #1976d2;
        }

        .question-content {
            margin-bottom: 15px;
            font-size: 16px;
        }

        .options-list {
            margin-bottom: 15px;
        }

        .option-item {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .option-item input {
            margin-right: 10px;
        }

        .essay-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 100px;
            margin-bottom: 10px;
            resize: vertical;
        }

        .question-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* ç­”æ¡ˆæ˜¾ç¤ºæ ·å¼ */
        .answer-display {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .answer-correct {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            color: #2e7d32;
        }

        .answer-incorrect {
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
            color: #c62828;
        }
        .result-stat-value.unsubmitted { color: #FF9800; }

        .answer-header {
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        .question-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .nav-item {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e0e0e0;
            cursor: pointer;
            font-size: 12px;
        }

        .nav-item.active {
            background-color: #4CAF50;
            color: white;
        }

        .nav-item.completed {
            background-color: #81C784;
            color: white;
        }

        .nav-item.incorrect {
            background-color: #E57373;
            color: white;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .modal {
            background-color: white;
            border-radius: 5px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 0;
        }

        .modal-body {
            padding: 15px;
        }

        .modal-footer {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* ç»Ÿè®¡ä¿¡æ¯æ ·å¼ */
        .stats-container {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼æ ·å¼ */
        @media (max-width: 768px) {
            .btn-group {
                flex-direction: column;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .question-actions {
                flex-direction: column;
            }

            .stats-container {
                flex-direction: column;
                align-items: center;
            }

            .stat-item {
                width: 100%;
            }
        }

        /* é€‰æ‹©æ¡†æ ·å¼ */
        .question-select {
            margin-right: 10px;
        }

        /* æ‰¹é‡æ“ä½œæ  */
        .batch-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }

        .select-all-container {
            display: flex;
            align-items: center;
        }

        .select-all-container input {
            margin-right: 5px;
        }

        /* ç»“æœç»Ÿè®¡æ¨¡æ€æ¡† */
        .result-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .result-stat-item {
            text-align: center;
            padding: 10px;
            flex: 1;
            min-width: 100px;
        }

        .result-stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .correct {
            color: #4CAF50;
        }

        .incorrect {
            color: #f44336;
        }

        .accuracy {
            color: #2196F3;
        }

        /* ç§»åŠ¨ç«¯èœå• */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #4CAF50;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 100;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            bottom: 90px;
            right: 20px;
            flex-direction: column;
            gap: 10px;
            z-index: 99;
        }

        .mobile-menu button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .desktop-actions {
                display: none;
            }

            .mobile-menu-btn,
            .mobile-menu.active {
                display: flex;
            }
        }

        /* è§†å›¾åˆ‡æ¢æ ·å¼ */
        .view-toggle {
            display: flex;
            margin-bottom: 15px;
        }

        .view-toggle button {
            background-color: white;
            color: #333;
            border: 1px solid #ddd;
        }

        .view-toggle button.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .view-toggle button:first-child {
            border-radius: 4px 0 0 4px;
        }

        .view-toggle button:last-child {
            border-radius: 0 4px 4px 0;
        }

        /* å…¨éƒ¨é¢˜ç›®è§†å›¾æ ·å¼ */
        body.all-questions .pagination {
            display: none !important;
        }

        body.all-questions .question-nav {
            display: none !important;
        }

        .question-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .question-card {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .question-card .question-actions {
            margin-top: auto;
        }

        /* è¿‡æ»¤æ§ä»¶ */
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
        }

        .filter-group select {
            width: auto;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="container">
                <h1>é¢˜åº“ç»ƒä¹ ç³»ç»Ÿ</h1>
            </div>
        </header>

        <div class="stats-container">
            <div class="stat-item">
                <span class="stat-value" id="total-questions">0</span>
                <span class="stat-label">æ€»é¢˜æ•°</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="completed-questions">0</span>
                <span class="stat-label">å·²ç­”é¢˜</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="correct-questions">0</span>
                <span class="stat-label">æ­£ç¡®ç‡</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="current-progress">0%</span>
                <span class="stat-label">å®Œæˆè¿›åº¦</span>
            </div>
        </div>

        <div class="filter-controls">
            <div class="filter-group">
                <label for="type-filter">é¢˜ç›®ç±»å‹:</label>
                <select id="type-filter" onchange="handleFilterChange()">
                    <option value="all">å…¨éƒ¨ç±»å‹</option>
                    <option value="single">å•é€‰é¢˜</option>
                    <option value="multiple">å¤šé€‰é¢˜</option>
                    <option value="judge">åˆ¤æ–­é¢˜</option>
                    <option value="essay">ç®€ç­”é¢˜</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="status-filter">çŠ¶æ€:</label>
                <select id="status-filter" onchange="handleFilterChange()">
                    <option value="all">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="unanswered">æœªå›ç­”</option>
                    <option value="answered">å·²ç­”é¢˜</option>
                    <option value="correct">å›ç­”æ­£ç¡®</option>
                    <option value="incorrect">å›ç­”é”™è¯¯</option>
                </select>
            </div>
        </div>

        <div class="view-toggle">
            <button id="list-view-btn" class="active" onclick="toggleViewMode('list')">åˆ—è¡¨è§†å›¾</button>
            <button id="grid-view-btn" onclick="toggleViewMode('grid')">ç½‘æ ¼è§†å›¾</button>
            <button id="all-questions-view-btn" onclick="toggleViewMode('all')">å…¨éƒ¨é¢˜ç›®è§†å›¾</button>
        </div>

        <div class="batch-actions">
            <div class="select-all-container">
                <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                <label for="select-all">å…¨é€‰</label>
            </div>
            <div class="desktop-actions">
                <button id="submit-selected" onclick="submitSelectedAnswers()">æäº¤é€‰ä¸­</button>
                <button id="reset-selected" onclick="resetSelectedAnswers()">é‡ç½®é€‰ä¸­</button>
                <button id="delete-selected" class="btn-danger" onclick="deleteSelectedQuestions()">åˆ é™¤é€‰ä¸­</button>
            </div>
        </div>

        <div class="btn-group desktop-actions">
            <button id="add-question" class="btn-secondary" onclick="openAddQuestionModal()">æ·»åŠ é¢˜ç›®</button>
            <button id="batch-add-question" class="btn-secondary" onclick="openBatchAddQuestionModal()">æ‰¹é‡æ·»åŠ </button>
            <button id="import-questions" class="btn-secondary" onclick="openImportModal()">å¯¼å…¥é¢˜ç›®</button>
            <button id="export-questions" class="btn-secondary" onclick="exportQuestions()">å¯¼å‡ºé¢˜ç›®</button>
            <button id="submit-all" onclick="submitAllAnswers()">æäº¤å…¨éƒ¨</button>
            <button id="reset-all" onclick="resetAllAnswers()">é‡ç½®å…¨éƒ¨</button>
            <button id="show-all-answers">æ˜¾ç¤º/éšè—ç­”æ¡ˆ</button>
        </div>

        <div class="loading">
            <div class="loading-spinner"></div>
            <div>åŠ è½½ä¸­...</div>
        </div>

        <div id="questions-container" class="questions-container"></div>

        <div class="pagination">
            <button id="prev-page" onclick="goToPrevPage()">ä¸Šä¸€é¡µ</button>
    <span id="page-info">ç¬¬ 1 é¡µ</span>
    <button onclick="setQuestionsPerPage(5)">5é¢˜/é¡µ</button>
    <button onclick="setQuestionsPerPage(10)">10é¢˜/é¡µ</button>
    <button id="next-page" onclick="goToNextPage()">ä¸‹ä¸€é¡µ</button>
        </div>

        <div class="question-nav" id="question-nav"></div>

        <!-- ç¼–è¾‘é¢˜ç›®æ¨¡æ€æ¡† -->
        <div class="modal-overlay" id="edit-question-modal">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">ç¼–è¾‘é¢˜ç›®</h2>
                    <button class="modal-close" onclick="closeEditQuestionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="edit-question-form">
                        <input type="hidden" id="edit-question-id">
                        <div class="form-group">
                            <label for="edit-question-type">é¢˜ç›®ç±»å‹:</label>
                            <select id="edit-question-type" name="type" required onchange="handleEditQuestionTypeChange()">
                                <option value="single">å•é€‰é¢˜</option>
                                <option value="multiple">å¤šé€‰é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                                <option value="essay">ç®€ç­”é¢˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-question-content">é¢˜ç›®å†…å®¹:</label>
                            <textarea id="edit-question-content" name="content" required rows="4"></textarea>
                        </div>
                        <div id="edit-options-container">
                            <div class="form-group">
                                <label>é€‰é¡¹:</label>
                                <div id="edit-options-list">
                                    <div class="option-item">
                                        <input type="text" name="edit-option" placeholder="é€‰é¡¹ A" required>
                                    </div>
                                    <div class="option-item">
                                        <input type="text" name="edit-option" placeholder="é€‰é¡¹ B" required>
                                    </div>
                                </div>
                                <button type="button" class="btn-secondary" onclick="addEditOption()">æ·»åŠ é€‰é¡¹</button>
                            </div>
                        </div>
                        <div class="form-group" id="edit-judge-options" style="display: none;">
                            <label>æ­£ç¡®ç­”æ¡ˆ:</label>
                            <div class="option-item">
                                <input type="radio" id="edit-judge-true" name="edit-judge-option" value="true" required>
                                <label for="edit-judge-true">æ­£ç¡®</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="edit-judge-false" name="edit-judge-option" value="false">
                                <label for="edit-judge-false">é”™è¯¯</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit-question-answer">æ­£ç¡®ç­”æ¡ˆ:</label>
                            <textarea id="edit-question-answer" name="answer" required placeholder="ä¾‹å¦‚ï¼šA æˆ– ABC æˆ– æ­£ç¡® æˆ– å…·ä½“æ–‡æœ¬" rows="3"></textarea>
                            <small id="edit-answer-hint">æç¤ºï¼šå•é€‰é¢˜å’Œå¤šé€‰é¢˜è¯·è¾“å…¥é€‰é¡¹å­—æ¯ï¼ˆå¦‚Aã€BCï¼‰ï¼Œåˆ¤æ–­é¢˜è¯·è¾“å…¥"æ­£ç¡®"æˆ–"é”™è¯¯"</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button onclick="closeEditQuestionModal()">å–æ¶ˆ</button>
                    <button onclick="updateQuestion()">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡† -->
        <div class="modal-overlay" id="add-question-modal">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">æ·»åŠ æ–°é¢˜ç›®</h2>
                    <button class="modal-close" onclick="closeAddQuestionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="add-question-form">
                        <div class="form-group">
                            <label for="question-type">é¢˜ç›®ç±»å‹:</label>
                            <select id="question-type" name="type" required onchange="handleQuestionTypeChange()">
                                <option value="single">å•é€‰é¢˜</option>
                                <option value="multiple">å¤šé€‰é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                                <option value="essay">ç®€ç­”é¢˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="question-content">é¢˜ç›®å†…å®¹:</label>
                            <textarea id="question-content" name="content" required rows="4"></textarea>
                        </div>
                        <div id="options-container">
                            <div class="form-group">
                                <label>é€‰é¡¹:</label>
                                <div id="options-list">
                                    <div class="option-item">
                                        <input type="text" name="option" placeholder="é€‰é¡¹ A" required>
                                    </div>
                                    <div class="option-item">
                                        <input type="text" name="option" placeholder="é€‰é¡¹ B" required>
                                    </div>
                                </div>
                                <button type="button" class="btn-secondary" onclick="addOption()">æ·»åŠ é€‰é¡¹</button>
                            </div>
                        </div>
                        <div class="form-group" id="judge-options" style="display: none;">
                            <label>æ­£ç¡®ç­”æ¡ˆ:</label>
                            <div class="option-item">
                                <input type="radio" id="judge-true" name="judge-option" value="true" required>
                                <label for="judge-true">æ­£ç¡®</label>
                            </div>
                            <div class="option-item">
                                <input type="radio" id="judge-false" name="judge-option" value="false">
                                <label for="judge-false">é”™è¯¯</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="question-answer">æ­£ç¡®ç­”æ¡ˆ:</label>
                            <textarea id="question-answer" name="answer" required placeholder="ä¾‹å¦‚ï¼šA æˆ– ABC æˆ– æ­£ç¡® æˆ– å…·ä½“æ–‡æœ¬" rows="3"></textarea>
                            <small id="answer-hint">æç¤ºï¼šå•é€‰é¢˜å’Œå¤šé€‰é¢˜è¯·è¾“å…¥é€‰é¡¹å­—æ¯ï¼ˆå¦‚Aã€BCï¼‰ï¼Œåˆ¤æ–­é¢˜è¯·è¾“å…¥"æ­£ç¡®"æˆ–"é”™è¯¯"</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button onclick="closeAddQuestionModal()">å–æ¶ˆ</button>
                    <button onclick="saveQuestion()">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- æäº¤ç»“æœæ¨¡æ€æ¡† -->
        <div class="modal-overlay" id="result-modal">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">æäº¤ç»“æœ</h2>
                    <button class="modal-close" onclick="closeResultModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="result-stats">
                        <div class="result-stat-item">
                            <div class="result-stat-value" id="result-total">0</div>
                            <div class="result-stat-label">æ€»é¢˜æ•°</div>
                        </div>
                        <div class="result-stat-item">
                            <div class="result-stat-value correct" id="result-correct">0</div>
                            <div class="result-stat-label">æ­£ç¡®</div>
                        </div>
                        <div class="result-stat-item">
                            <div class="result-stat-value incorrect" id="result-incorrect">0</div>
                            <div class="result-stat-label">é”™è¯¯</div>
                        </div>
                        <div class="result-stat-item">
                            <div class="result-stat-value unsubmitted" id="result-unsubmitted">0</div>
                            <div class="result-stat-label">æœªç­”é¢˜</div>
                        </div>
                        <div class="result-stat-item">
                            <div class="result-stat-value accuracy" id="result-accuracy">0%</div>
                            <div class="result-stat-label">æ­£ç¡®ç‡</div>
                        </div>
                    </div>
                    <div id="result-details"></div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeResultModal()">å…³é—­</button>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡† -->
        <div class="modal-overlay" id="batch-add-question-modal">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">æ‰¹é‡æ·»åŠ é¢˜ç›®</h2>
                    <button class="modal-close" onclick="closeBatchAddQuestionModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="batch-question-content">é¢˜ç›®å†…å®¹ (è¯·æŒ‰ç…§æŒ‡å®šæ ¼å¼è¾“å…¥å¤šä¸ªé¢˜ç›®ï¼Œæ¯ä¸ªé¢˜ç›®ä»¥ç©ºè¡Œåˆ†éš”)</label>
                        <textarea id="batch-question-content" rows="15" placeholder="ç¤ºä¾‹ï¼š
å•é€‰é¢˜ï¼š1.é¢˜ç›®å†…å®¹
A.é€‰é¡¹1
B.é€‰é¡¹2
C.é€‰é¡¹3
D.é€‰é¡¹4
æ­£ç¡®ç­”æ¡ˆï¼šA

å¤šé€‰é¢˜ï¼š1.é¢˜ç›®å†…å®¹
A.é€‰é¡¹1
B.é€‰é¡¹2
C.é€‰é¡¹3
D.é€‰é¡¹4
æ­£ç¡®ç­”æ¡ˆï¼šABCD

åˆ¤æ–­é¢˜ï¼š1.é¢˜ç›®å†…å®¹
æ­£ç¡®ç­”æ¡ˆï¼šæ­£ç¡®

é—®ç­”é¢˜ï¼š1.é¢˜ç›®å†…å®¹
æ­£ç¡®ç­”æ¡ˆï¼šç­”æ¡ˆå†…å®¹"></textarea>
                        <small>æ”¯æŒæ ¼å¼ï¼šå•é€‰é¢˜ã€å¤šé€‰é¢˜ã€åˆ¤æ–­é¢˜ã€é—®ç­”é¢˜ï¼Œæ¯ä¸ªé¢˜ç›®ä»¥ç©ºè¡Œåˆ†éš”</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeBatchAddQuestionModal()">å–æ¶ˆ</button>
                    <button onclick="saveBatchQuestions()">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- å¯¼å…¥é¢˜ç›®æ¨¡æ€æ¡† -->
        <div class="modal-overlay" id="import-modal">
            <div class="modal">
                <div class="modal-header">
                    <h2 class="modal-title">å¯¼å…¥é¢˜ç›®</h2>
                    <button class="modal-close" onclick="closeImportModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="import-file">é€‰æ‹©TXTæ–‡ä»¶</label>
                        <input type="file" id="import-file" accept=".txt">
                        <small>è¯·ä¸Šä¼ ç¬¦åˆæ ¼å¼è¦æ±‚çš„TXTæ–‡ä»¶ï¼Œæ”¯æŒå•é€‰é¢˜ã€å¤šé€‰é¢˜ã€åˆ¤æ–­é¢˜ã€é—®ç­”é¢˜</small>
                    </div>
                    <div id="import-status" style="margin-top: 15px;"></div>
                </div>
                <div class="modal-footer">
                    <button onclick="closeImportModal()">å–æ¶ˆ</button>
                    <button onclick="importQuestions()">å¯¼å…¥</button>
                </div>
            </div>
        </div>

        <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
        <button class="mobile-menu-btn" id="mobile-menu-btn" onclick="toggleMobileMenu()">+</button>
        <div class="mobile-menu" id="mobile-menu">
            <button onclick="openAddQuestionModal()" title="æ·»åŠ é¢˜ç›®">+</button>
            <button onclick="submitSelectedAnswers()" title="æäº¤é€‰ä¸­">âœ“</button>
            <button onclick="resetSelectedAnswers()" title="é‡ç½®é€‰ä¸­">â†º</button>
            <button onclick="deleteSelectedQuestions()" title="åˆ é™¤é€‰ä¸­">âœ•</button>
            <button onclick="toggleShowAllAnswers()" title="æ˜¾ç¤ºç­”æ¡ˆ">ğŸ‘ï¸</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let questions = [];
        let currentPage = 1;
        let questionsPerPage = 10;
        let currentViewMode = 'list';
        let showAllAnswers = false;
        let currentFilters = {
            type: 'all',
            status: 'all'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestionsFromLocalStorage();
            renderQuestions();
            renderQuestionNav();
            updateStats();
            initEventListeners();
        });

        // æ‰¹é‡æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡†æ§åˆ¶
        function openBatchAddQuestionModal() {
            document.getElementById('batch-add-question-modal').style.display = 'flex';
            document.getElementById('batch-question-content').value = '';
        }

        function closeBatchAddQuestionModal() {
            document.getElementById('batch-add-question-modal').style.display = 'none';
        }

        // å¯¼å…¥æ¨¡æ€æ¡†æ§åˆ¶
        function openImportModal() {
            document.getElementById('import-modal').style.display = 'flex';
            document.getElementById('import-file').value = '';
            document.getElementById('import-status').textContent = '';
        }

        function closeImportModal() {
            document.getElementById('import-modal').style.display = 'none';
        }

        // è§£æé¢˜ç›®æ–‡æœ¬
        function parseQuestionText(text) {
            const questions = [];
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            let currentQuestion = null;
            let currentType = '';
            let expectingAnswer = false;

            for (let line of lines) {
                if (line.startsWith('å•é€‰é¢˜ï¼š')) {
                    if (currentQuestion) questions.push(currentQuestion);
                    currentType = 'single';
                    currentQuestion = {
                        type: 'single',
                        content: line.replace('å•é€‰é¢˜ï¼š', '').trim(),
                        options: [],
                        answer: ''
                    };
                    expectingAnswer = false;
                } else if (line.startsWith('å¤šé€‰é¢˜ï¼š')) {
                    if (currentQuestion) questions.push(currentQuestion);
                    currentType = 'multiple';
                    currentQuestion = {
                        type: 'multiple',
                        content: line.replace('å¤šé€‰é¢˜ï¼š', '').trim(),
                        options: [],
                        answer: ''
                    };
                    expectingAnswer = false;
                } else if (line.startsWith('åˆ¤æ–­é¢˜ï¼š')) {
                    if (currentQuestion) questions.push(currentQuestion);
                    currentType = 'judge';
                    currentQuestion = {
                        type: 'judge',
                        content: line.replace('åˆ¤æ–­é¢˜ï¼š', '').trim(),
                        options: [],
                        answer: ''
                    };
                    expectingAnswer = false;
                } else if (line.startsWith('é—®ç­”é¢˜ï¼š')) {
                    if (currentQuestion) questions.push(currentQuestion);
                    currentType = 'essay';
                    currentQuestion = {
                        type: 'essay',
                        content: line.replace('é—®ç­”é¢˜ï¼š', '').trim(),
                        options: [],
                        answer: ''
                    };
                    expectingAnswer = false;
                } else if (line.startsWith('æ­£ç¡®ç­”æ¡ˆï¼š')) {
                    if (currentQuestion) {
                        currentQuestion.answer = line.replace('æ­£ç¡®ç­”æ¡ˆï¼š', '').trim();
                        expectingAnswer = true;
                    }
                } else if (currentQuestion && !expectingAnswer) {
                    // å¤„ç†é€‰é¡¹
                    if ((currentType === 'single' || currentType === 'multiple') && line.match(/^[A-Z]\./)) {
                        currentQuestion.options.push(line.substring(2).trim());
                    } else if (currentType === 'judge') {
                        // åˆ¤æ–­é¢˜æ²¡æœ‰é€‰é¡¹ï¼Œç›´æ¥ç­‰å¾…ç­”æ¡ˆ
                    } else if (currentType === 'essay') {
                        // é—®ç­”é¢˜å†…å®¹å¯èƒ½æœ‰å¤šè¡Œ
                        currentQuestion.content += '\n' + line;
                    }
                }
            }

            // æ·»åŠ æœ€åä¸€ä¸ªé¢˜ç›®
            if (currentQuestion) questions.push(currentQuestion);

            return questions;
        }

        // ä¿å­˜æ‰¹é‡æ·»åŠ çš„é¢˜ç›®
        function saveBatchQuestions() {
            const content = document.getElementById('batch-question-content').value;
            if (!content.trim()) {
                alert('è¯·è¾“å…¥é¢˜ç›®å†…å®¹');
                return;
            }

            try {
                const parsedQuestions = parseQuestionText(content);
                if (parsedQuestions.length === 0) {
                    alert('æœªè§£æåˆ°ä»»ä½•é¢˜ç›®ï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®');
                    return;
                }

                // è½¬æ¢ä¸ºç³»ç»Ÿé¢˜ç›®æ ¼å¼å¹¶æ·»åŠ åˆ°é¢˜åº“
                const newQuestions = parsedQuestions.map(q => ({
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 5),
                    type: q.type,
                    content: q.content,
                    options: q.options,
                    answer: q.answer,
                    userAnswer: null,
                    isCorrect: null,
                    selected: false
                }));

                questions.push(...newQuestions);
                saveQuestionsToLocalStorage();
                renderQuestions();
                renderQuestionNav();
                updateStats();
                closeBatchAddQuestionModal();
                alert(`æˆåŠŸæ·»åŠ  ${newQuestions.length} é“é¢˜ç›®`);
            } catch (e) {
                console.error('æ‰¹é‡æ·»åŠ é¢˜ç›®å¤±è´¥:', e);
                alert('è§£æé¢˜ç›®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®');
            }
        }

        // å¯¼å…¥é¢˜ç›®
        function importQuestions() {
            const fileInput = document.getElementById('import-file');
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('è¯·é€‰æ‹©è¦å¯¼å…¥çš„TXTæ–‡ä»¶');
                return;
            }

            const file = fileInput.files[0];
            if (file.type !== 'text/plain' && !file.name.endsWith('.txt')) {
                alert('è¯·é€‰æ‹©TXTæ ¼å¼çš„æ–‡ä»¶');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const parsedQuestions = parseQuestionText(content);

                    if (parsedQuestions.length === 0) {
                        document.getElementById('import-status').textContent = 'æœªè§£æåˆ°ä»»ä½•é¢˜ç›®ï¼Œè¯·æ£€æŸ¥æ ¼å¼æ˜¯å¦æ­£ç¡®';
                        document.getElementById('import-status').style.color = 'red';
                        return;
                    }

                    // è½¬æ¢ä¸ºç³»ç»Ÿé¢˜ç›®æ ¼å¼å¹¶æ·»åŠ åˆ°é¢˜åº“
                    const newQuestions = parsedQuestions.map(q => ({
                        id: Date.now().toString() + Math.random().toString(36).substr(2, 5),
                        type: q.type,
                        content: q.content,
                        options: q.options,
                        answer: q.answer,
                        userAnswer: null,
                        isCorrect: null,
                        selected: false
                    }));

                    questions.push(...newQuestions);
                    saveQuestionsToLocalStorage();
                    renderQuestions();
                    renderQuestionNav();
                    updateStats();

                    document.getElementById('import-status').textContent = `æˆåŠŸå¯¼å…¥ ${newQuestions.length} é“é¢˜ç›®`;
                    document.getElementById('import-status').style.color = 'green';

                    // 3ç§’åå…³é—­æ¨¡æ€æ¡†
                    setTimeout(() => {
                        closeImportModal();
                    }, 1500);
                } catch (e) {
                    console.error('å¯¼å…¥é¢˜ç›®å¤±è´¥:', e);
                    document.getElementById('import-status').textContent = 'å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®';
                    document.getElementById('import-status').style.color = 'red';
                }
            };
            reader.onerror = function() {
                document.getElementById('import-status').textContent = 'æ–‡ä»¶è¯»å–å¤±è´¥';
                document.getElementById('import-status').style.color = 'red';
            };
            reader.readAsText(file, 'UTF-8');
        }

        // å¯¼å‡ºé¢˜ç›®
        function exportQuestions() {
            if (questions.length === 0) {
                alert('å½“å‰æ²¡æœ‰é¢˜ç›®å¯å¯¼å‡º');
                return;
            }

            let exportText = '';
            questions.forEach(question => {
                // æ ¹æ®é¢˜ç›®ç±»å‹æ·»åŠ å‰ç¼€
                switch(question.type) {
                    case 'single':
                        exportText += `å•é€‰é¢˜ï¼š${question.content}\n`;
                        break;
                    case 'multiple':
                        exportText += `å¤šé€‰é¢˜ï¼š${question.content}\n`;
                        break;
                    case 'judge':
                        exportText += `åˆ¤æ–­é¢˜ï¼š${question.content}\n`;
                        break;
                    case 'essay':
                        exportText += `é—®ç­”é¢˜ï¼š${question.content}\n`;
                        break;
                }

                // æ·»åŠ é€‰é¡¹ï¼ˆå•é€‰å’Œå¤šé€‰é¢˜ï¼‰
                if (question.type === 'single' || question.type === 'multiple') {
                    question.options.forEach((option, index) => {
                        const optionLetter = String.fromCharCode(65 + index); // A, B, C...
                        exportText += `${optionLetter}.${option}\n`;
                    });
                }

                // æ·»åŠ æ­£ç¡®ç­”æ¡ˆ
                exportText += `æ­£ç¡®ç­”æ¡ˆï¼š${question.answer}\n\n`;
            });

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `é¢˜åº“å¯¼å‡º_${new Date().toLocaleDateString().replace(/\//g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            addEventListenerSafe('type-filter', 'change', handleFilterChange);
            addEventListenerSafe('status-filter', 'change', handleFilterChange);
            addEventListenerSafe('list-view-btn', 'click', () => toggleViewMode('list'));
            addEventListenerSafe('grid-view-btn', 'click', () => toggleViewMode('grid'));
            addEventListenerSafe('all-view-btn', 'click', () => toggleViewMode('all'));
            addEventListenerSafe('select-all', 'change', toggleSelectAll);
            addEventListenerSafe('submit-selected', 'click', submitSelectedAnswers);
            addEventListenerSafe('reset-selected', 'click', resetSelectedAnswers);
            addEventListenerSafe('delete-selected', 'click', deleteSelectedQuestions);
            addEventListenerSafe('add-question', 'click', openAddQuestionModal);
            addEventListenerSafe('submit-all', 'click', submitAllAnswers);
            addEventListenerSafe('reset-all', 'click', resetAllAnswers);
            addEventListenerSafe('show-all-answers', 'click', toggleShowAllAnswers);
            addEventListenerSafe('prev-page', 'click', goToPrevPage);
            addEventListenerSafe('next-page', 'click', goToNextPage);
            addEventListenerSafe('mobile-menu-btn', 'click', toggleMobileMenu);
            addEventListenerSafe('question-type', 'change', handleQuestionTypeChange);
        }

        // å®‰å…¨æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        function addEventListenerSafe(elementId, event, handler) {
            const element = document.getElementById(elementId);
            if (element) {
                element.addEventListener(event, handler);
            } else {
                console.warn(`Element with ID ${elementId} not found`);
            }
        }

        // åŠ è½½é¢˜ç›®æ•°æ®
        function loadQuestionsFromLocalStorage() {
            try {
                const savedQuestions = localStorage.getItem('questions');
                if (savedQuestions) {
                    questions = JSON.parse(savedQuestions);
                    // ç¡®ä¿æ‰€æœ‰é¢˜ç›®éƒ½æœ‰selectedå±æ€§
                    questions.forEach(question => {
                        if (question.selected === undefined) {
                            question.selected = false;
                        }
                    });
                }
            } catch (e) {
                console.error('Failed to load questions from localStorage:', e);
                questions = [];
            }
        }

        // ä¿å­˜é¢˜ç›®æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveQuestionsToLocalStorage() {
            try {
                localStorage.setItem('questions', JSON.stringify(questions));
                console.log('ç­”é¢˜æ•°æ®å·²æˆåŠŸä¿å­˜');
            } catch (e) {
                console.error('Failed to save questions to localStorage:', e);
                alert('ä¿å­˜ç­”é¢˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³æˆ–æµè§ˆå™¨è®¾ç½®ã€‚');
            }
        }

        function updateUserAnswer(questionId, answer) {
            const question = questions.find(q => q.id === questionId);
            if (question) {
                question.userAnswer = answer;
                saveQuestionsToLocalStorage();
            }
        }

        function setQuestionsPerPage(count) {
            questionsPerPage = count;
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            renderQuestions();
            renderQuestionNav();
        }

        function updateMultipleAnswer(questionId, option, isChecked) {
            const question = questions.find(q => q.id === questionId);
            if (question) {
                if (!question.userAnswer) question.userAnswer = '';
                if (isChecked) {
                    if (!question.userAnswer.includes(option)) {
                        question.userAnswer += option;
                    }
                } else {
                    question.userAnswer = question.userAnswer.replace(option, '');
                }
                saveQuestionsToLocalStorage();
            }
        }

        function setQuestionsPerPage(count) {
            questionsPerPage = count;
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            renderQuestions();
            renderQuestionNav();
        }

        function setQuestionsPerPage(count) {
            questionsPerPage = count;
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            renderQuestions();
            renderQuestionNav();
        }

        // åˆ‡æ¢è§†å›¾æ¨¡å¼
        function toggleViewMode(mode) {
            currentViewMode = mode;
            const body = document.body;
            if (mode === 'all') {
                body.classList.add('all-questions');
                currentPage = 1;
            } else {
                body.classList.remove('all-questions');
            }
            renderQuestions();
            renderQuestionNav();
        }

        // æ¸²æŸ“é¢˜ç›®åˆ—è¡¨
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            if (!container) return;

            container.innerHTML = '';

            // åº”ç”¨è¿‡æ»¤
            const filteredQuestions = filterQuestions();

            // æ ¹æ®è§†å›¾æ¨¡å¼å†³å®šæ˜¯å¦åˆ†é¡µ
            let currentPageQuestions;
            let startIndex = 0;
            if (currentViewMode === 'all') {
                currentPageQuestions = filteredQuestions;
                // éšè—åˆ†é¡µæ§ä»¶
                const paginationControls = document.getElementById('pagination-controls');
                if (paginationControls) {
                    paginationControls.style.display = 'none';
                }
            } else {
                // åˆ†é¡µå¤„ç†
                const totalPages = Math.ceil(filteredQuestions.length / questionsPerPage);
                currentPage = Math.max(1, Math.min(currentPage, totalPages));
                startIndex = (currentPage - 1) * questionsPerPage;
                currentPageQuestions = filteredQuestions.slice(startIndex, startIndex + questionsPerPage);

                // æ›´æ–°åˆ†é¡µä¿¡æ¯å¹¶æ˜¾ç¤ºæ§ä»¶
                const pageInfo = document.getElementById('page-info');
                if (pageInfo) {
                    pageInfo.textContent = `ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ`;
                }
                const prevPageBtn = document.getElementById('prev-page');
                if (prevPageBtn) {
                    prevPageBtn.disabled = currentPage <= 1;
                }
                const nextPageBtn = document.getElementById('next-page');
                if (nextPageBtn) {
                    nextPageBtn.disabled = currentPage >= totalPages;
                }
                const paginationControls = document.getElementById('pagination-controls');
                if (paginationControls) {
                    paginationControls.style.display = 'flex';
                }
            }

            if (currentPageQuestions.length === 0) {
                container.innerHTML = '<div class="no-questions">æ²¡æœ‰æ‰¾åˆ°é¢˜ç›®ï¼Œè¯·æ·»åŠ æ–°é¢˜ç›®ã€‚</div>';
                return;
            }

            // è®¾ç½®å®¹å™¨æ ·å¼
            if (currentViewMode === 'grid') {
                container.classList.add('question-grid');
            } else {
                container.classList.remove('question-grid');
            }

            // æ¸²æŸ“é¢˜ç›®
            currentPageQuestions.forEach((question, index) => {
                const questionElement = createQuestionElement(question, startIndex + index);
                container.appendChild(questionElement);
            });
        }

        // åˆ›å»ºé¢˜ç›®å…ƒç´ 
        function createQuestionElement(question, displayIndex) {
            const questionDiv = document.createElement('div');
            questionDiv.className = currentViewMode === 'grid' ? 'question-card' : 'question-block';
            questionDiv.dataset.id = question.id;

            // é¢˜ç›®ç±»å‹æ ‡ç­¾
            let typeLabel = '';
            switch(question.type) {
                case 'single': typeLabel = 'å•é€‰é¢˜'; break;
                case 'multiple': typeLabel = 'å¤šé€‰é¢˜'; break;
                case 'judge': typeLabel = 'åˆ¤æ–­é¢˜'; break;
                case 'essay': typeLabel = 'ç®€ç­”é¢˜'; break;
                default: typeLabel = 'æœªçŸ¥é¢˜å‹';
            }

            // é¢˜ç›®å¤´éƒ¨
            const headerHtml = `
                <div class="question-header">
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                            <input type="checkbox" class="question-select" data-id="${question.id}" ${question.selected ? 'checked' : ''} onchange="toggleQuestionSelection('${question.id}')">
                            <span class="question-number">${displayIndex + 1}.</span>
                            <span class="question-type">${typeLabel}</span>
                            <div class="question-title-actions" style="margin-left: 15px;">
                                <button onclick="resetUserAnswer('${question.id}')" ${!question.userAnswer ? 'disabled' : ''} class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">é‡ç½®</button>
                                <button onclick="openEditQuestionModal('${question.id}')" class="btn-secondary" style="padding: 5px 10px; font-size: 12px;">ç¼–è¾‘</button>
                                <button onclick="deleteQuestion('${question.id}')" class="btn-danger" style="padding: 5px 10px; font-size: 12px;">åˆ é™¤</button>
                            </div>
                        </div>
                        <div class="question-status ${question.userAnswer ? (question.isCorrect ? 'status-correct' : 'status-incorrect') : 'status-unanswered'}">
                            ${question.userAnswer ? (question.isCorrect ? 'å·²ç­”é¢˜ - æ­£ç¡®' : 'å·²ç­”é¢˜ - é”™è¯¯') : 'æœªç­”é¢˜'}
                        </div>
                </div>
                </div>
                <div class="question-content">${escapeHtml(question.content).replace(/\n/g, '<br>')}</div>
            `;
            questionDiv.innerHTML = headerHtml;

            // é€‰é¡¹åŒºåŸŸ
            if (question.type === 'single' || question.type === 'multiple') {
                const optionsList = document.createElement('div');
                optionsList.className = 'options-list';

                question.options.forEach((option, i) => {
                    const optionLetter = String.fromCharCode(65 + i); // A, B, C...
                    const optionItem = document.createElement('div');
                    optionItem.className = 'option-item';
                    optionItem.innerHTML = `
                        <input type="${question.type === 'single' ? 'radio' : 'checkbox'}" 
                               name="q-${question.id}" 
                               value="${optionLetter}" 
                               id="q-${question.id}-${optionLetter}" 
                               ${question.userAnswer && question.userAnswer.includes(optionLetter) ? 'checked' : ''} 
                               ${question.userAnswer !== null ? 'disabled' : ''} 
                               onchange="${question.type === 'single' ? `updateUserAnswer('${question.id}', this.value)` : `updateMultipleAnswer('${question.id}', this.value, this.checked)`}">
                        <label for="q-${question.id}-${optionLetter}">${optionLetter}. ${escapeHtml(option)}</label>
                    `;
                    optionsList.appendChild(optionItem);
                });
                questionDiv.appendChild(optionsList);
            } 
            // åˆ¤æ–­é¢˜
            else if (question.type === 'judge') {
                const optionsList = document.createElement('div');
                optionsList.className = 'options-list';
                optionsList.innerHTML = `
                    <div class="option-item">
                        <input type="radio" name="q-${question.id}" value="æ­£ç¡®" id="q-${question.id}-true" 
                               ${question.userAnswer === 'æ­£ç¡®' ? 'checked' : ''} ${question.userAnswer !== null ? 'disabled' : ''} 
                               onchange="updateUserAnswer('${question.id}', this.value)">
                        <label for="q-${question.id}-true">æ­£ç¡®</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="q-${question.id}" value="é”™è¯¯" id="q-${question.id}-false" 
                               ${question.userAnswer === 'é”™è¯¯' ? 'checked' : ''} ${question.userAnswer !== null ? 'disabled' : ''} 
                               onchange="updateUserAnswer('${question.id}', this.value)">
                        <label for="q-${question.id}-false">é”™è¯¯</label>
                    </div>
                `;
                questionDiv.appendChild(optionsList);
            } 
            // ç®€ç­”é¢˜
            else if (question.type === 'essay') {
                const essayInput = document.createElement('textarea');
                essayInput.className = 'essay-input';
                essayInput.id = `q-${question.id}-essay`;
                essayInput.placeholder = 'è¯·è¾“å…¥ç­”æ¡ˆ...';
                essayInput.value = question.userAnswer || '';
                essayInput.disabled = question.userAnswer !== null;
                essayInput.addEventListener('input', function() {
                    updateUserAnswer('${question.id}', this.value);
                });
                questionDiv.appendChild(essayInput);
            }

            // æ“ä½œæŒ‰é’®
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'question-actions';
            actionsDiv.innerHTML = `
                <button onclick="submitAnswer('${question.id}')" ${question.userAnswer !== null ? 'disabled' : ''}>æäº¤ç­”æ¡ˆ</button>
            `;
            questionDiv.appendChild(actionsDiv);

            // ç­”æ¡ˆæ˜¾ç¤º
            const answerDiv = document.createElement('div');
            answerDiv.className = `answer-display ${question.isCorrect ? 'answer-correct' : 'answer-incorrect'}`;
            answerDiv.id = `answer-${question.id}`;

            let answerContent = '';
            if (question.type === 'single' || question.type === 'multiple') {
                // å¯¹äºé€‰æ‹©é¢˜ï¼Œæ˜¾ç¤ºæ­£ç¡®é€‰é¡¹çš„æ–‡æœ¬
                const correctLetters = question.answer.split('');
                const correctOptions = correctLetters.map(letter => {
                    const index = letter.charCodeAt(0) - 65;
                    return question.options[index] ? `${letter}. ${escapeHtml(question.options[index])}` : '';
                }).filter(Boolean);
                answerContent = correctOptions.join('<br>');
            } else {
                answerContent = escapeHtml(question.answer).replace(/\n/g, '<br>');
            }

            answerDiv.innerHTML = `
                <div class="answer-header">${question.isCorrect ? 'æ­£ç¡®ç­”æ¡ˆ' : 'æ­£ç¡®ç­”æ¡ˆ'}ï¼š</div>
                <div>${answerContent}</div>
            `;
            questionDiv.appendChild(answerDiv);

            // å¦‚æœå·²ç»æäº¤ç­”æ¡ˆã€è®¾ç½®äº†æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆæˆ–é¢˜ç›®å·²è¢«æ ‡è®°æ­£ç¡®æ€§ï¼Œåˆ™æ˜¾ç¤ºç­”æ¡ˆ
            if (question.userAnswer || showAllAnswers || question.isCorrect !== null) {
                answerDiv.style.display = 'block';
            }

            return questionDiv;
        }

        // æ¸²æŸ“é¢˜ç›®å¯¼èˆª
        function renderQuestionNav() {
            const navContainer = document.getElementById('question-nav');
            if (!navContainer) return;

            // åœ¨å…¨éƒ¨é¢˜ç›®è§†å›¾ä¸‹éšè—å¯¼èˆª
            if (currentViewMode === 'all') {
                navContainer.style.display = 'none';
                return;
            } else {
                navContainer.style.display = 'flex';
            }

            navContainer.innerHTML = '';
            const filteredQuestions = filterQuestions();

            filteredQuestions.forEach((question, index) => {
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.textContent = index + 1;
                navItem.onclick = () => goToQuestion(index);

                if (question.userAnswer) {
                    navItem.classList.add(question.isCorrect ? 'completed' : 'incorrect');
                }

                // æ£€æŸ¥å½“å‰é¡µæ˜¯å¦åŒ…å«æ­¤é¢˜ç›®
                const startIndex = (currentPage - 1) * questionsPerPage;
                const endIndex = startIndex + questionsPerPage;
                if (index >= startIndex && index < endIndex) {
                    navItem.classList.add('active');
                }

                navContainer.appendChild(navItem);
            });
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalQuestions = questions.length;
            const completedQuestions = questions.filter(q => q.userAnswer !== null).length;
            const correctQuestions = questions.filter(q => q.isCorrect).length;
            const progress = totalQuestions > 0 ? Math.round((completedQuestions / totalQuestions) * 100) : 0;
            const accuracy = completedQuestions > 0 ? Math.round((correctQuestions / completedQuestions) * 100) : 0;

            document.getElementById('total-questions').textContent = totalQuestions;
            document.getElementById('completed-questions').textContent = completedQuestions;
            document.getElementById('correct-questions').textContent = accuracy + '%';
            document.getElementById('current-progress').textContent = progress + '%';
        }

        // è¿‡æ»¤é¢˜ç›®
        function filterQuestions() {
            return questions.filter(question => {
                // ç±»å‹è¿‡æ»¤
                if (currentFilters.type !== 'all' && question.type !== currentFilters.type) {
                    return false;
                }

                // çŠ¶æ€è¿‡æ»¤
                if (currentFilters.status === 'unanswered') {
                    return question.userAnswer === null;
                } else if (currentFilters.status === 'answered') {
                    return question.userAnswer !== null;
                } else if (currentFilters.status === 'correct') {
                    return question.isCorrect === true;
                } else if (currentFilters.status === 'incorrect') {
                    return question.isCorrect === false;
                }

                return true;
            });
        }

        // å¤„ç†é¢˜ç›®ç±»å‹å˜åŒ–
        function handleQuestionTypeChange() {
            const type = document.getElementById('question-type').value;
            const optionsContainer = document.getElementById('options-container');
            const judgeOptions = document.getElementById('judge-options');
            const answerInput = document.getElementById('question-answer');
            const answerHint = document.getElementById('answer-hint');

            if (type === 'judge') {
                optionsContainer.style.display = 'none';
                judgeOptions.style.display = 'block';
                answerInput.value = 'æ­£ç¡®';
                answerInput.readOnly = true;
                answerHint.textContent = 'æç¤ºï¼šåˆ¤æ–­é¢˜ç­”æ¡ˆå°†æ ¹æ®é€‰æ‹©è‡ªåŠ¨è®¾ç½®';
            } else {
                optionsContainer.style.display = 'block';
                judgeOptions.style.display = 'none';
                answerInput.readOnly = false;

                if (type === 'single' || type === 'multiple') {
                    answerHint.textContent = 'æç¤ºï¼šè¯·è¾“å…¥é€‰é¡¹å­—æ¯ï¼ˆå¦‚Aã€BCï¼‰';
                } else if (type === 'essay') {
                    answerHint.textContent = 'æç¤ºï¼šè¯·è¾“å…¥ç®€ç­”é¢˜çš„æ­£ç¡®ç­”æ¡ˆæ–‡æœ¬';
                }

                // å¦‚æœæ˜¯å•é€‰é¢˜æˆ–å¤šé€‰é¢˜ä¸”é€‰é¡¹åˆ—è¡¨ä¸ºç©ºï¼Œæ·»åŠ é»˜è®¤é€‰é¡¹
                const optionsList = document.getElementById('options-list');
                if ((type === 'single' || type === 'multiple') && optionsList.children.length === 0) {
                    addOption();
                    addOption();
                }
            }
        }

        // æ·»åŠ é€‰é¡¹
        function addOption() {
            const optionsList = document.getElementById('options-list');
            const optionCount = optionsList.children.length;

            if (optionCount >= 26) {
                alert('æœ€å¤šåªèƒ½æ·»åŠ 26ä¸ªé€‰é¡¹');
                return;
            }

            const optionLetter = String.fromCharCode(65 + optionCount); // A, B, C...
            const optionItem = document.createElement('div');
            optionItem.className = 'option-item';
            optionItem.innerHTML = `
                <input type="text" name="option" placeholder="é€‰é¡¹ ${optionLetter}" required>
                ${optionCount > 1 ? '<button type="button" class="btn-danger" onclick="removeOption(this)">åˆ é™¤</button>' : ''}
            `;
            optionsList.appendChild(optionItem);

            // æ›´æ–°å…¶ä»–é€‰é¡¹çš„åˆ é™¤æŒ‰é’®çŠ¶æ€
            updateOptionDeleteButtons();
        }

        // ç§»é™¤é€‰é¡¹
        function removeOption(button) {
            const optionsList = document.getElementById('options-list');
            optionsList.removeChild(button.parentElement);

            // æ›´æ–°é€‰é¡¹å­—æ¯
            updateOptionLetters();
            // æ›´æ–°åˆ é™¤æŒ‰é’®çŠ¶æ€
            updateOptionDeleteButtons();
        }

        // æ›´æ–°é€‰é¡¹å­—æ¯
        function updateOptionLetters() {
            const optionsList = document.getElementById('options-list');
            const optionItems = optionsList.querySelectorAll('.option-item');

            optionItems.forEach((item, index) => {
                const optionLetter = String.fromCharCode(65 + index);
                const input = item.querySelector('input');
                input.placeholder = `é€‰é¡¹ ${optionLetter}`;
            });
        }

        // æ›´æ–°é€‰é¡¹åˆ é™¤æŒ‰é’®çŠ¶æ€
        function updateOptionDeleteButtons() {
            const optionsList = document.getElementById('options-list');
            const optionItems = optionsList.querySelectorAll('.option-item');
            const deleteButtons = optionsList.querySelectorAll('.btn-danger');

            // æ˜¾ç¤ºæ‰€æœ‰åˆ é™¤æŒ‰é’®
            deleteButtons.forEach(button => {
                button.style.display = 'inline-block';
            });

            // å¦‚æœåªå‰©ä¸€ä¸ªé€‰é¡¹ï¼Œéšè—å…¶åˆ é™¤æŒ‰é’®
            if (optionItems.length <= 1 && deleteButtons.length > 0) {
                deleteButtons[0].style.display = 'none';
            }
        }

        // æ‰“å¼€æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡†
        function openAddQuestionModal() {
            document.getElementById('add-question-modal').style.display = 'flex';
            document.getElementById('add-question-form').reset();
            document.getElementById('options-list').innerHTML = '';
            addOption();
            addOption();
            handleQuestionTypeChange();
        }

        // å…³é—­æ·»åŠ é¢˜ç›®æ¨¡æ€æ¡†
        function openEditQuestionModal(questionId) {
        const question = questions.find(q => q.id === questionId);
        if (!question) return;

        document.getElementById('edit-question-id').value = question.id;
        document.getElementById('edit-question-type').value = question.type;
        document.getElementById('edit-question-content').value = question.content;
        document.getElementById('edit-question-answer').value = question.answer;

        // å¤„ç†é¢˜ç›®ç±»å‹æ˜¾ç¤º
        handleEditQuestionTypeChange();

        // å¡«å……é€‰é¡¹
        const optionsList = document.getElementById('edit-options-list');
        const judgeOptions = document.getElementById('edit-judge-options');
        optionsList.innerHTML = '';

        if (question.type === 'single' || question.type === 'multiple') {
            question.options.forEach((option, index) => {
                const optionItem = document.createElement('div');
                optionItem.className = 'option-item';
                optionItem.innerHTML = `<input type="text" name="edit-option" value="${option}" placeholder="é€‰é¡¹ ${String.fromCharCode(65 + index)}" required>`;
                optionsList.appendChild(optionItem);
            });
        } else if (question.type === 'judge') {
            document.getElementById('edit-judge-true').checked = question.answer === 'æ­£ç¡®';
            document.getElementById('edit-judge-false').checked = question.answer === 'é”™è¯¯';
        }

        document.getElementById('edit-question-modal').style.display = 'flex';
    }

    function closeEditQuestionModal() {
        document.getElementById('edit-question-modal').style.display = 'none';
        document.getElementById('edit-question-form').reset();
    }

    function handleEditQuestionTypeChange() {
        const type = document.getElementById('edit-question-type').value;
        const optionsContainer = document.getElementById('edit-options-container');
        const judgeOptions = document.getElementById('edit-judge-options');
        const answerInput = document.getElementById('edit-question-answer');
        const answerHint = document.getElementById('edit-answer-hint');

        optionsContainer.style.display = 'none';
        judgeOptions.style.display = 'none';

        if (type === 'single' || type === 'multiple') {
            optionsContainer.style.display = 'block';
            answerHint.textContent = 'æç¤ºï¼šè¯·è¾“å…¥é€‰é¡¹å­—æ¯ï¼ˆå¦‚Aã€BCï¼‰';
        } else if (type === 'judge') {
            judgeOptions.style.display = 'block';
            answerHint.textContent = 'æç¤ºï¼šè¯·é€‰æ‹©æ­£ç¡®æˆ–é”™è¯¯';
        } else if (type === 'essay') {
            answerHint.textContent = 'æç¤ºï¼šè¯·è¾“å…¥ç®€ç­”é¢˜çš„æ­£ç¡®ç­”æ¡ˆ';
        }
    }

    function addEditOption() {
        const optionsList = document.getElementById('edit-options-list');
        const optionCount = optionsList.children.length;
        const optionItem = document.createElement('div');
        optionItem.className = 'option-item';
        optionItem.innerHTML = `<input type="text" name="edit-option" placeholder="é€‰é¡¹ ${String.fromCharCode(65 + optionCount)}" required>`;
        optionsList.appendChild(optionItem);
    }

    function updateQuestion() {
        const questionId = document.getElementById('edit-question-id').value;
        const type = document.getElementById('edit-question-type').value;
        const content = document.getElementById('edit-question-content').value;
        let answer = document.getElementById('edit-question-answer').value;

        // å¤„ç†åˆ¤æ–­é¢˜ç­”æ¡ˆ
        if (type === 'judge') {
            answer = document.getElementById('edit-judge-true').checked ? 'æ­£ç¡®' : 'é”™è¯¯';
        }

        // æ”¶é›†é€‰é¡¹
        const options = [];
        if (type === 'single' || type === 'multiple') {
            document.querySelectorAll('input[name="edit-option"]').forEach(input => {
                if (input.value.trim()) options.push(input.value.trim());
            });
        }

        // æ›´æ–°é¢˜ç›®
        const questionIndex = questions.findIndex(q => q.id === questionId);
        if (questionIndex !== -1) {
            questions[questionIndex] = {
                ...questions[questionIndex],
                type,
                content,
                options,
                answer,
                // é‡ç½®ç”¨æˆ·ç­”æ¡ˆå’Œæ­£ç¡®æ€§çŠ¶æ€
                userAnswer: null,
                isCorrect: null
            };

            saveQuestionsToLocalStorage();
            renderQuestions();
            closeEditQuestionModal();
        }
    }

    function closeAddQuestionModal() {
            document.getElementById('add-question-modal').style.display = 'none';
        }

        // ä¿å­˜é¢˜ç›®
        function saveQuestion() {
            const type = document.getElementById('question-type').value;
            const content = document.getElementById('question-content').value.trim();
            let answer = document.getElementById('question-answer').value.trim();

            if (!content || !answer) {
                alert('é¢˜ç›®å†…å®¹å’Œç­”æ¡ˆä¸èƒ½ä¸ºç©º');
                return;
            }

            // å¤„ç†é€‰é¡¹
            let options = [];
            if (type === 'single' || type === 'multiple') {
                const optionInputs = document.querySelectorAll('#options-list input');
                options = Array.from(optionInputs).map(input => input.value.trim());

                // éªŒè¯é€‰é¡¹
                if (options.some(opt => !opt)) {
                    alert('é€‰é¡¹å†…å®¹ä¸èƒ½ä¸ºç©º');
                    return;
                }

                // éªŒè¯ç­”æ¡ˆæ ¼å¼
                if (type === 'single' && !/^[A-Z]$/.test(answer)) {
                    alert('å•é€‰é¢˜çš„ç­”æ¡ˆå¿…é¡»æ˜¯å•ä¸ªå­—æ¯ï¼ˆA-Zï¼‰');
                    return;
                }

                if (type === 'multiple' && !/^[A-Z]+$/.test(answer)) {
                    alert('å¤šé€‰é¢˜çš„ç­”æ¡ˆå¿…é¡»æ˜¯å­—æ¯ç»„åˆï¼ˆå¦‚ï¼šABCï¼‰');
                    return;
                }

                // éªŒè¯ç­”æ¡ˆæ˜¯å¦åœ¨é€‰é¡¹èŒƒå›´å†…
                for (let i = 0; i < answer.length; i++) {
                    const letterIndex = answer.charCodeAt(i) - 65;
                    if (letterIndex < 0 || letterIndex >= options.length) {
                        alert(`ç­”æ¡ˆåŒ…å«æ— æ•ˆé€‰é¡¹: ${answer[i]}`);
                        return;
                    }
                }
            } else if (type === 'judge') {
                // å¯¹äºåˆ¤æ–­é¢˜ï¼Œä»å•é€‰æŒ‰é’®è·å–ç­”æ¡ˆ
                const selectedOption = document.querySelector('input[name="judge-option"]:checked');
                if (!selectedOption) {
                    alert('è¯·é€‰æ‹©åˆ¤æ–­é¢˜çš„æ­£ç¡®ç­”æ¡ˆ');
                    return;
                }
                answer = selectedOption.value === 'true' ? 'æ­£ç¡®' : 'é”™è¯¯';
            }

            // åˆ›å»ºæ–°é¢˜ç›®
            const newQuestion = {
                id: Date.now().toString(),
                type,
                content,
                options,
                answer,
                userAnswer: null,
                isCorrect: null,
                selected: false
            };

            // æ·»åŠ åˆ°é¢˜ç›®åˆ—è¡¨
            questions.push(newQuestion);

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveQuestionsToLocalStorage();

            // æ›´æ–°UI
            renderQuestions();
            renderQuestionNav();
            updateStats();
            closeAddQuestionModal();

            // æ»šåŠ¨åˆ°æ–°æ·»åŠ çš„é¢˜ç›®
            setTimeout(() => {
                const lastQuestion = document.querySelector('#questions-container > div:last-child');
                if (lastQuestion) {
                    lastQuestion.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 300);
        }

        // éªŒè¯ç­”æ¡ˆ
        function validateAnswer(question) {
            if (!question.userAnswer) return false;

            switch(question.type) {
                case 'single':
                case 'judge':
                    return question.userAnswer === question.answer;
                case 'multiple':
                    // å¯¹å¤šé€‰é¢˜ç­”æ¡ˆè¿›è¡Œæ’åºåæ¯”è¾ƒ
                    return question.userAnswer.split('').sort().join('') === question.answer.split('').sort().join('');
                case 'essay':
                    // ç®€ç­”é¢˜ç®€å•æ¯”è¾ƒæ–‡æœ¬ï¼ˆå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼‰
                    return question.userAnswer.trim() === question.answer.trim();
                default:
                    return false;
            }
        }

        // æäº¤ç­”æ¡ˆ
        function submitAnswer(questionId, skipRender = false) {
            const questionIndex = questions.findIndex(q => q.id === questionId);
            if (questionIndex === -1) return;
            const question = questions[questionIndex];
            let userAnswer = null;

            // è·å–ç”¨æˆ·ç­”æ¡ˆ
            if (question.type === 'single' || question.type === 'multiple') {
                const selectedOptions = document.querySelectorAll(`input[name="q-${questionId}"]:checked`);
                if (selectedOptions.length === 0) {
                    alert('è¯·é€‰æ‹©ç­”æ¡ˆ');
                    return;
                }
                userAnswer = Array.from(selectedOptions).map(option => option.value).join('');
            } else if (question.type === 'judge') {
                const selectedOption = document.querySelector(`input[name="q-${questionId}"]:checked`);
                if (!selectedOption) {
                    alert('è¯·é€‰æ‹©ç­”æ¡ˆ');
                    return;
                }
                userAnswer = selectedOption.value;
            } else if (question.type === 'essay') {
                const essayInput = document.getElementById(`q-${questionId}-essay`);
                userAnswer = essayInput ? escapeHtml(essayInput.value.trim()) : '';
            }

            if (userAnswer === null || userAnswer === '') {
                alert('è¯·é€‰æ‹©æˆ–è¾“å…¥ç­”æ¡ˆ');
                return;
            }

            // æ›´æ–°é¢˜ç›®çŠ¶æ€
            questions[questionIndex].userAnswer = userAnswer;

            // ç»Ÿä¸€æ¢è¡Œç¬¦å¹¶å»é™¤é¦–å°¾ç©ºç™½
            const normalizeAnswer = (answer) => {
                return answer.replace(/\r\n/g, '\n').trim();
            };

            // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
            if (question.type === 'essay') {
                const normalizedUserAnswer = normalizeAnswer(userAnswer);
                const normalizedCorrectAnswer = normalizeAnswer(question.answer);
                questions[questionIndex].isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
            } else {
                questions[questionIndex].isCorrect = userAnswer === question.answer;
            }

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            if (!skipRender) {
                saveQuestionsToLocalStorage();
            }

            // æ›´æ–°UI
            if (!skipRender) {
                renderQuestions();
                renderQuestionNav();
                updateStats();
            }
        }

        // é‡ç½®ç”¨æˆ·ç­”æ¡ˆ
        function resetUserAnswer(questionId, skipRender = false) {
            const questionIndex = questions.findIndex(q => q.id === questionId);
            if (questionIndex === -1) return;

            // é‡ç½®é¢˜ç›®çŠ¶æ€
            questions[questionIndex].userAnswer = null;
            questions[questionIndex].isCorrect = null;

            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            if (!skipRender) {
                saveQuestionsToLocalStorage();
            }

            // æ›´æ–°UI
            if (!skipRender) {
                renderQuestions();
                renderQuestionNav();
                updateStats();
            }
        }

        // åˆ é™¤é¢˜ç›®
        function deleteQuestion(questionId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿ')) return;

            questions = questions.filter(q => q.id !== questionId);
            saveQuestionsToLocalStorage();
            showAllAnswers = false; // é‡ç½®æ˜¾ç¤ºç­”æ¡ˆçŠ¶æ€
            document.getElementById('show-all-answers').textContent = 'æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆ'; // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            renderQuestions();
            renderQuestionNav();
            updateStats();
        }

        // æäº¤å…¨éƒ¨ç­”æ¡ˆ
        function submitAllAnswers() {
            const answeredQuestions = questions.filter(q => q.userAnswer !== null);
            const unAnsweredQuestions = questions.filter(q => q.userAnswer === null);

            if (answeredQuestions.length === 0) {
                alert('æ²¡æœ‰å¯æäº¤çš„é¢˜ç›®ï¼Œè¯·å…ˆå›ç­”é—®é¢˜');
                return;
            }

            let confirmMessage = `ç¡®å®šè¦æäº¤æ‰€æœ‰${answeredQuestions.length}é“å·²å›ç­”çš„é¢˜ç›®å—ï¼Ÿ`;
            if (unAnsweredQuestions.length > 0) {
                confirmMessage += `\næ³¨æ„ï¼šè¿˜æœ‰${unAnsweredQuestions.length}é“é¢˜ç›®æœªå›ç­”ï¼Œå°†è¢«è§†ä¸ºé”™è¯¯ã€‚`;
            }

            if (!confirm(confirmMessage)) {
                return;
            }

            showSubmissionProgress();
            processAllSubmission();
        }

        // å¤„ç†å…¨éƒ¨æäº¤
        function showSubmissionProgress() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'submission-progress-modal';
            modal.innerHTML = `
                <div class="modal" style="max-width: 400px;">
                    <div class="modal-header">
                        <h2 class="modal-title">æ­£åœ¨æäº¤ç­”æ¡ˆ</h2>
                    </div>
                    <div class="modal-body">
                        <div class="progress-container" style="margin: 20px 0;">
                            <div id="progress-bar" style="height: 10px; background-color: #4CAF50; width: 0%; border-radius: 5px;"></div>
                        </div>
                        <div id="progress-text">æ­£åœ¨æäº¤ç¬¬ 0 é¢˜ / å…± ${questions.length} é¢˜</div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function updateSubmissionProgress(current, total) {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            if (progressBar && progressText) {
                const percentage = Math.round((current / total) * 100);
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `æ­£åœ¨æäº¤ç¬¬ ${current} é¢˜ / å…± ${total} é¢˜`;
            }
        }

        function processAllSubmission() {
            let correctCount = 0;
            let incorrectCount = 0;
            let unsubmittedCount = 0;
            let totalCount = questions.length;
            let currentQuestion = 0;

            // åˆ›å»ºä¸€ä¸ªå¤„ç†é¢˜ç›®çš„Promise
            const processQuestions = () => {
                return new Promise((resolve) => {
                    const processNextQuestion = () => {
                        if (currentQuestion >= questions.length) {
                            resolve(correctCount);
                            return;
                        }

                        const question = questions[currentQuestion];
                        currentQuestion++;
                        updateSubmissionProgress(currentQuestion, totalCount);

                        // å¯¹äºæœªå›ç­”çš„é¢˜ç›®ï¼Œè§†ä¸ºé”™è¯¯å¹¶æ ‡è®°ä¸ºå·²ç­”é¢˜
                if (question.userAnswer === null) {
                    unsubmittedCount++;
                } else {
                    // éªŒè¯ç­”æ¡ˆ
                    question.isCorrect = validateAnswer(question);
                    if (question.isCorrect) {
                        correctCount++;
                    } else {
                        incorrectCount++;
                    }
                }

                        // çŸ­æš‚å»¶è¿Ÿä»¥æ˜¾ç¤ºè¿›åº¦
                        setTimeout(processNextQuestion, 50);
                    };

                    processNextQuestion();
                });
            };

            // å¤„ç†æ‰€æœ‰é¢˜ç›®å¹¶æ˜¾ç¤ºç»“æœ
            processQuestions().then(() => {
                showAllAnswers = true;
                saveQuestionsToLocalStorage();
                renderQuestions();
                renderQuestionNav();
                updateStats();
                // ç§»é™¤è¿›åº¦æ¨¡æ€æ¡†
                const modal = document.getElementById('submission-progress-modal');
                if (modal) modal.remove();
                showSubmissionResult(correctCount, incorrectCount, unsubmittedCount, totalCount);
            }).catch((error) => {
                console.error('æäº¤è¿‡ç¨‹å‡ºé”™:', error);
                alert('æäº¤è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                const modal = document.getElementById('submission-progress-modal');
                if (modal) modal.remove();
            });
        }

        // é‡ç½®å…¨éƒ¨ç­”æ¡ˆ
        function resetAllAnswers() {
            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é¢˜ç›®çš„ç­”æ¡ˆå—ï¼Ÿè¿™å°†æ¸…é™¤æ‚¨çš„ç­”é¢˜è®°å½•ã€‚')) return;

            questions.forEach(question => {
                resetUserAnswer(question.id, true);
            });

            saveQuestionsToLocalStorage();
            showAllAnswers = false; // é‡ç½®æ˜¾ç¤ºç­”æ¡ˆçŠ¶æ€
            document.getElementById('show-all-answers').textContent = 'æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆ'; // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            renderQuestions();
            renderQuestionNav();
            updateStats();
        }

        // åˆ‡æ¢æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆ
        function toggleShowAllAnswers() {
            showAllAnswers = !showAllAnswers;
            document.getElementById('show-all-answers').textContent = showAllAnswers ? 'éšè—æ‰€æœ‰ç­”æ¡ˆ' : 'æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆ';
            renderQuestions();
        }

        // å‰å¾€ä¸Šä¸€é¡µ
        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderQuestions();
                renderQuestionNav();
                window.scrollTo(0, 0);
            }
        }

        // å‰å¾€ä¸‹ä¸€é¡µ
        function goToNextPage() {
            const filteredQuestions = filterQuestions();
            const totalPages = Math.ceil(filteredQuestions.length / questionsPerPage);

            if (currentPage < totalPages) {
                currentPage++;
                renderQuestions();
                renderQuestionNav();
                window.scrollTo(0, 0);
            }
        }

        // å‰å¾€æŒ‡å®šé¢˜ç›®
        function goToQuestion(index) {
            currentPage = Math.floor(index / questionsPerPage) + 1;
            renderQuestions();
            renderQuestionNav();

            // æ»šåŠ¨åˆ°é¢˜ç›®ä½ç½®
            const questionElement = document.querySelector(`[data-id="${filterQuestions()[index].id}"]`);
            if (questionElement) {
                questionElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // é«˜äº®æ•ˆæœ
                questionElement.style.backgroundColor = '#e3f2fd';
                setTimeout(() => {
                    questionElement.style.backgroundColor = '';
                }, 1000);
            }
        }

        // å¤„ç†è¿‡æ»¤æ¡ä»¶å˜åŒ–
        function handleFilterChange() {
            currentFilters.type = document.getElementById('type-filter').value;
            currentFilters.status = document.getElementById('status-filter').value;
            currentPage = 1; // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
            renderQuestions();
            renderQuestionNav();
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯èœå•
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('active');
        }

        // åˆ‡æ¢è§†å›¾æ¨¡å¼
        function toggleViewMode(mode) {
            currentViewMode = mode;
            const body = document.body;
            // åˆ‡æ¢åˆ°å…¨éƒ¨é¢˜ç›®è§†å›¾æ—¶é‡ç½®ä¸ºç¬¬ä¸€é¡µ
            if (mode === 'all') {
                currentPage = 1;
            }
            document.getElementById('list-view-btn').classList.toggle('active', mode === 'list');
            document.getElementById('grid-view-btn').classList.toggle('active', mode === 'grid');
            document.getElementById('all-questions-view-btn').classList.toggle('active', mode === 'all');
            body.classList.toggle('all-questions', mode === 'all');
            renderQuestions();
        }

        // åˆå§‹åŒ–é¢˜ç›®é€‰æ‹©çŠ¶æ€
        function initQuestionSelectionState() {
            questions.forEach(question => {
                if (question.selected === undefined) {
                    question.selected = false;
                }
            });
        }

        // åˆ‡æ¢é¢˜ç›®é€‰æ‹©çŠ¶æ€
        function toggleQuestionSelection(questionId) {
            const questionIndex = questions.findIndex(q => q.id === questionId);
            if (questionIndex !== -1) {
                questions[questionIndex].selected = !questions[questionIndex].selected;
                // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
                updateSelectAllState();
            }
        }

        // åˆ‡æ¢å…¨é€‰çŠ¶æ€
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('select-all');
            const filteredQuestions = filterQuestions();
            // å…¨éƒ¨é¢˜ç›®è§†å›¾æ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®ï¼Œå…¶ä»–è§†å›¾ä½¿ç”¨åˆ†é¡µ
            let currentPageQuestions;
            if (currentViewMode === 'all') {
                currentPageQuestions = filteredQuestions;
            } else {
                const startIndex = (currentPage - 1) * questionsPerPage;
                const endIndex = startIndex + questionsPerPage;
                currentPageQuestions = filteredQuestions.slice(startIndex, endIndex);
            }

            currentPageQuestions.forEach(question => {
                const questionIndex = questions.findIndex(q => q.id === question.id);
                if (questionIndex !== -1) {
                    questions[questionIndex].selected = selectAllCheckbox.checked;
                }
            });

            // æ›´æ–°UIä¸­çš„å¤é€‰æ¡†
            document.querySelectorAll('.question-select').forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        }

        // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
        function updateSelectAllState() {
            const filteredQuestions = filterQuestions();
            // å…¨éƒ¨é¢˜ç›®è§†å›¾æ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®ï¼Œå…¶ä»–è§†å›¾ä½¿ç”¨åˆ†é¡µ
            let currentPageQuestions;
            if (currentViewMode === 'all') {
                currentPageQuestions = filteredQuestions;
            } else {
                const startIndex = (currentPage - 1) * questionsPerPage;
                const endIndex = startIndex + questionsPerPage;
                currentPageQuestions = filteredQuestions.slice(startIndex, endIndex);
            }

            const allSelected = currentPageQuestions.every(question => {
                const q = questions.find(q => q.id === question.id);
                return q && q.selected;
            });

            document.getElementById('select-all').checked = allSelected;
        }

        // è·å–é€‰ä¸­çš„é¢˜ç›®
        function getSelectedQuestions() {
            return questions.filter(q => q.selected);
        }

        // æäº¤é€‰ä¸­çš„é¢˜ç›®
        function submitSelectedAnswers() {
            const selectedQuestions = getSelectedQuestions();
            if (selectedQuestions.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦æäº¤çš„é¢˜ç›®');
                return;
            }

            // åˆ†ç¦»å·²ç­”é¢˜å’Œæœªç­”é¢˜
            const answeredQuestions = selectedQuestions.filter(q => q.userAnswer !== null);
            const unansweredQuestions = selectedQuestions.filter(q => q.userAnswer === null);
            const unsubmittedCount = unansweredQuestions.length;

            if (answeredQuestions.length === 0 && unsubmittedCount > 0) {
                // å…¨éƒ¨æœªç­”é¢˜
                showSubmissionResult(0, 0, unsubmittedCount, selectedQuestions.length);
                return;
            }

            // æäº¤å·²ç­”é¢˜ - æ¯æ¬¡æäº¤åç«‹å³ä¿å­˜å’Œæ›´æ–°UIä»¥ç¡®ä¿åŒæ­¥
            answeredQuestions.forEach(question => {
                submitAnswer(question.id, false); // è®¾ä¸ºfalseï¼Œç«‹å³ä¿å­˜å’Œæ›´æ–°
            });

            // å¤„ç†æœªç­”é¢˜ï¼Œæ ‡è®°ä¸ºé”™è¯¯å¹¶ä¿å­˜çŠ¶æ€
            unansweredQuestions.forEach(question => {
                question.isCorrect = false;
            });
            saveQuestionsToLocalStorage();

            // ç»Ÿè®¡ç»“æœå¹¶æ˜¾ç¤ºç­”æ¡ˆ
            const correctCount = answeredQuestions.filter(q => q.isCorrect).length;
            const incorrectCount = answeredQuestions.length - correctCount;
            showSubmissionResult(correctCount, incorrectCount, unsubmittedCount, selectedQuestions.length);
            renderQuestions(); // å¼ºåˆ¶åˆ·æ–°UIæ˜¾ç¤ºç­”æ¡ˆ
        }

        // æ˜¾ç¤ºæäº¤ç»“æœ
        function showSubmissionResult(correctCount, incorrectCount, unsubmittedCount, totalCount) {
            const resultModal = document.getElementById('result-modal');
            const resultTotal = document.getElementById('result-total');
            const resultCorrect = document.getElementById('result-correct');
            const resultIncorrect = document.getElementById('result-incorrect');
            const resultAccuracy = document.getElementById('result-accuracy');
            const resultDetails = document.getElementById('result-details');

            resultTotal.textContent = totalCount;
            resultCorrect.textContent = correctCount;
            resultIncorrect.textContent = incorrectCount;
            const resultUnsubmitted = document.getElementById('result-unsubmitted');
            resultUnsubmitted.textContent = unsubmittedCount;
            const accuracy = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;
            resultAccuracy.textContent = `${accuracy}%`;

            // ç”Ÿæˆç»“æœè¯¦æƒ…
            let detailsHtml = '<div><strong>æäº¤è¯¦æƒ…ï¼š</strong></div>';
            if (totalCount === 0) {
                detailsHtml += '<div>æ²¡æœ‰æäº¤ä»»ä½•é¢˜ç›®</div>';
            } else {
                detailsHtml += `<div>å…±æäº¤ ${totalCount} é“é¢˜ç›®ï¼Œå…¶ä¸­ï¼š</div>`;
                detailsHtml += `<div>â€¢ æ­£ç¡®ï¼š${correctCount} é“</div>`;
                detailsHtml += `<div>â€¢ é”™è¯¯ï¼š${incorrectCount} é“</div>`;
                detailsHtml += `<div>â€¢ æœªç­”é¢˜ï¼š${unsubmittedCount} é“ï¼ˆç­”æ¡ˆå·²æ˜¾ç¤ºï¼‰</div>`;
            }

            resultDetails.innerHTML = detailsHtml;
            resultModal.style.display = 'flex';
        }

        // å…³é—­ç»“æœæ¨¡æ€æ¡†
        function closeResultModal() {
            document.getElementById('result-modal').style.display = 'none';
        }

        // é‡ç½®é€‰ä¸­çš„é¢˜ç›®
        function resetSelectedAnswers() {
            const selectedQuestions = getSelectedQuestions();
            if (selectedQuestions.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦é‡ç½®çš„é¢˜ç›®');
                return;
            }

            if (!confirm(`ç¡®å®šè¦é‡ç½®é€‰ä¸­çš„${selectedQuestions.length}é“é¢˜ç›®çš„ç­”æ¡ˆå—ï¼Ÿ`)) {
                return;
            }

            selectedQuestions.forEach((question, index) => {
                resetUserAnswer(question.id, true);

                // æœ€åä¸€ä¸ªé¢˜ç›®é‡ç½®å®Œæˆåæ›´æ–°UI
                if (index === selectedQuestions.length - 1) {
                    saveQuestionsToLocalStorage();
                    renderQuestions();
                    renderQuestionNav();
                    updateStats();
                    alert(`å·²é‡ç½®é€‰ä¸­çš„${selectedQuestions.length}é“é¢˜ç›®çš„ç­”æ¡ˆ`);
                }
            });
        }

        // åˆ é™¤é€‰ä¸­çš„é¢˜ç›®
        function deleteSelectedQuestions() {
            const selectedQuestions = getSelectedQuestions();
            if (selectedQuestions.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¢˜ç›®');
                return;
            }

            if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„${selectedQuestions.length}é“é¢˜ç›®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                return;
            }

            // è¿‡æ»¤æ‰é€‰ä¸­çš„é¢˜ç›®
            questions = questions.filter(q => !q.selected);
            saveQuestionsToLocalStorage();
            showAllAnswers = false; // é‡ç½®æ˜¾ç¤ºç­”æ¡ˆçŠ¶æ€
            document.getElementById('show-all-answers').textContent = 'æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆ'; // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            renderQuestions();
            renderQuestionNav();
            updateStats();
            alert(`å·²åˆ é™¤é€‰ä¸­çš„${selectedQuestions.length}é“é¢˜ç›®`);
        }

        // é‡ç½®é¢˜ç›®çŠ¶æ€
        function resetQuestionState() {
            questions.forEach(question => {
                question.userAnswer = null;
                question.isCorrect = null;
                question.selected = false;
            });
            saveQuestionsToLocalStorage();
            showAllAnswers = false; // é‡ç½®æ˜¾ç¤ºç­”æ¡ˆçŠ¶æ€
            document.getElementById('show-all-answers').textContent = 'æ˜¾ç¤ºæ‰€æœ‰ç­”æ¡ˆ'; // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            renderQuestions();
            renderQuestionNav();
            updateStats();
        }

        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
